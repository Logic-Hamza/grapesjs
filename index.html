<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>GrapesJS</title>
    <link rel="stylesheet" href="dist/css/grapes.min.css">
    <link rel="stylesheet" href="./dist/Font-Awesome-4.7.0/css/font-awesome.css">
    <script src="dist/grapes.min.js"></script>
    <style>
      body,
      html {
        height: 100%;
        margin: 0;
      }
      .gjs-pn-panel{
   
      }
    </style>
  </head>

  <body>
    <div id="gjs" style="height:0px; overflow:hidden;">
    
  
      <div class="d-flex flex-column flex-shrink-0 p-3 bg-light" style="width: 280px;">
        <a href="/" class="d-flex align-items-center mb-3 mb-md-0 me-md-auto link-dark text-decoration-none">
          <svg class="bi me-2" width="40" height="32"><use xlink:href="#bootstrap"></use></svg>
          <span class="fs-4">Sidebar</span>
        </a>
        <hr>
        <ul class="nav nav-pills flex-column mb-auto">
          <li class="nav-item">
            <a href="#" class="nav-link active" aria-current="page">
              <svg class="bi me-2" width="16" height="16"><use xlink:href="#home"></use></svg>
              Home
            </a>
          </li>
          <li>
            <a href="#" class="nav-link link-dark">
              <svg class="bi me-2" width="16" height="16"><use xlink:href="#speedometer2"></use></svg>
              Dashboard
            </a>
          </li>
          <li>
            <a href="#" class="nav-link link-dark">
              <svg class="bi me-2" width="16" height="16"><use xlink:href="#table"></use></svg>
              Orders
            </a>
          </li>
          <li>
            <a href="#" class="nav-link link-dark">
              <svg class="bi me-2" width="16" height="16"><use xlink:href="#grid"></use></svg>
              Products
            </a>
          </li>
          <li>
            <a href="#" class="nav-link link-dark">
              <svg class="bi me-2" width="16" height="16"><use xlink:href="#people-circle"></use></svg>
              Customers
            </a>
          </li>
        </ul>
        <hr>
        <div class="dropdown">
          <a href="#" class="d-flex align-items-center link-dark text-decoration-none dropdown-toggle" id="dropdownUser2" data-bs-toggle="dropdown" aria-expanded="false">
            <img src="https://github.com/mdo.png" alt="" class="rounded-circle me-2" width="32" height="32">
            <strong>mdo</strong>
          </a>
          <ul class="dropdown-menu text-small shadow" aria-labelledby="dropdownUser2">
            <li><a class="dropdown-item" href="#">New project...</a></li>
            <li><a class="dropdown-item" href="#">Settings</a></li>
            <li><a class="dropdown-item" href="#">Profile</a></li>
            <li><hr class="dropdown-divider"></li>
            <li><a class="dropdown-item" href="#">Sign out</a></li>
          </ul>
        </div>
      </div>
    </div>

   
  

    <script type="text/javascript">
      var editor = grapesjs.init({
        showOffsets: 1,
        avoidInlineStyle: 1,
        noticeOnUnload: 0,
        container: '#gjs',
        height: '100%',
        fromElement: true,
        storageManager: { autoload: 0 }, 
        pageManager: {
        pages: [{
            id: 'page-1',
            name: 'Page 1',
            component: '<div id="comp1">Page 1</div>',
            styles: `#comp1 { color: red }`,
        }, {
            id: 'page-2',
            name: 'Page 2',
            component: '<div id="comp2">Page 2</div>',
            styles: `#comp2 { color: green }`,
        }, {
            id: 'page-3',
            name: 'Page 3',
            component: '<div id="comp3">Page 3</div>',
            styles: `#comp3 { color: blue }`,
        }]
        },
        canvas: {
        styles: [
        './bootstrap.css',
        ],
        scripts: [
          'https://code.jquery.com/jquery-3.3.1.slim.min.js',
          'https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js',
          'https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js'
        ],
      },
      styleManager : {
        clearProperties:1,
          sectors: [
            {
              name: 'General',
              open: false,
              buildProps: ['float', 'display', 'position', 'top', 'right', 'left', 'bottom']
            },{
              name: 'Flex',
              open: false,
              buildProps: ['flex-direction', 'flex-wrap', 'justify-content', 'align-items', 'align-content', 'order', 'flex-basis', 'flex-grow', 'flex-shrink', 'align-self']
            },{
              name: 'Dimension',
              open: false,
              buildProps: ['width', 'height', 'max-width', 'min-height', 'margin', 'padding'],
            },{
              name: 'Typography',
              open: false,
              buildProps: ['font-family', 'font-size', 'font-weight', 'letter-spacing', 'color', 'line-height', 'text-shadow'],
            },{
              name: 'Decorations',
              open: false,
              buildProps: ['border-radius-c', 'background-color', 'border-radius', 'border', 'box-shadow', 'background'],
            },{
              name: 'Extra',
              open: false,
              buildProps: ['transition', 'perspective', 'transform'],
            }
          ],
          
        },
      });


    async function getNode(doc){let node=[];let Nstylenode=[];        
    const getCSSCustomPropIndex =  () => [...doc.styleSheets];let styleSheets=[];let cssRule=[];
    getCSSCustomPropIndex().forEach((item)=>{
    if (item.href){if(item.href.indexOf(window.location.origin)=== 0){styleSheets.push(item)}}});
    styleSheets.forEach((item)=>{
      for(var i in item.cssRules){
        if(item.cssRules[i].type === 1){
          if(typeof(item.cssRules[i]) != "undefined" ){

            var beforeSplit =item.cssRules[i].style.cssText.split(';')
            // if(item.cssRules[i].style.cssText.indexOf("important")>0){
            for(var j=0;j<beforeSplit.length;j++){
              // if (beforeSplit[j].indexOf('important') > 0){
                Nstylenode.push(beforeSplit[j].split(':')[0].trim().toString())
              // }
            }
            console.log(item.cssRules[i].selectorText.trim())
            cssRule.push([item.cssRules[i].selectorText.trim(),Nstylenode])
            node=[];Nstylenode=[];
            }
          // }
        }
      }  
    });
    await localStorage.setItem("CssRules",JSON.stringify(cssRule))
  }
  
  const delay = ms => new Promise(res => setTimeout(res, ms));
  editor.on('load',async()=>{
        await delay(1000);
        await getNode(editor.Canvas.getFrameEl().contentWindow.document);

  await editor.Panels.addPanel({
  id: 'basic-actions',
  el: ".gjs-sm-sectors",
  buttons: [
    {
      id: 'visibility',
      active: true, // active by default
      className: 'btn-toggle-borders',
      label: '<u>B</u>',
      command: 'sw-visibility', // Built-in command
    }, {
      id: 'export',
      className: 'btn-open-export',
      label: 'Exp',
      command: 'export-template',
      context: 'export-template', // For grouping context of buttons from the same panel
    }, {
      id: 'show-json',
      className: 'btn-show-json',
      label: 'JSON',
      context: 'show-json',
      command(editor) {
        editor.Modal.setTitle('Components JSON')
          .setContent(`<textarea style="width:100%; height: 250px;">
            ${JSON.stringify(editor.getComponents())}
          </textarea>`)
          .open();
      },
    }
  ],
});





  });
  editor.addComponents(
'<nav class="navbar navbar-expand-lg navbar-light bg-light">\
  <div class="container-fluid">\
    <a class="navbar-brand" href="#">Navbar</a>\
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" \
    data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent"\
    aria-expanded="false" aria-label="Toggle navigation">\
      <span class="navbar-toggler-icon"></span>\
    </button>\
    <div class="collapse navbar-collapse" id="navbarSupportedContent">\
      <ul class="navbar-nav me-auto mb-2 mb-lg-0">\
        <li class="nav-item">\
          <a class="nav-link active" aria-current="page" href="#">Home</a>\
        </li>\
        <li class="nav-item">\
          <a class="nav-link" href="#">Link</a>\
        </li>\
        <li class="nav-item dropdown">\
          <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" \
          role="button" data-bs-toggle="dropdown" aria-expanded="false">\
            Dropdown\
          </a>\
          <ul class="dropdown-menu" aria-labelledby="navbarDropdown">\
            <li><a class="dropdown-item" href="#">Action</a></li>\
            <li><a class="dropdown-item" href="#">Another action</a></li>\
            <li><hr class="dropdown-divider"></li>\
            <li><a class="dropdown-item" href="#">Something else here</a></li>\
          </ul>\
        </li>\
        <li class="nav-item">\
          <a class="nav-link disabled" href="#" tabindex="-1" aria-disabled="true">Disabled</a>\
        </li>\
      </ul>\
      <form class="d-flex">\
        <input class="form-control me-2" type="search" placeholder="Search" aria-label="Search">\
        <button class="btn btn-outline-success" type="submit">Search</button>\
      </form>\
    </div>\
  </div>\
</nav>'
);



editor.Panels.addButton('options', 
[ { id: 'save', className: 'fa fa-floppy-o icon-blank', 
command: function(editor1, sender) { alert('Hello World') }, 
attributes: { title: 'Save Template' } }, ]);

</script>
</body>
</html>
